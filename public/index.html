<!DOCTYPE html>
<html lang="en" ng-app="app" ng-strict-di>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>LingvoMan</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
  </head>

  <body ng-controller="ApplicationCtrl as applicationCtrl">
    <!-- NAVBAR -->
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand" href="/">Lingvoman</a>
        </div>
        <!-- navbar form -->
        <form class="navbar-form navbar-left" name="applicationCtrl.gettingForm" novalidate>
          <div class="form-group">
            <!--project input group -->
            <div class="input-group">
              <div class="input-group-btn">
                <!--dropdown button -->
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Проект <span class="caret"></span>
                </button>
                  <!-- dropdawn btn LIST -->
                <ul class="dropdown-menu">
                  <li ng-repeat="project in applicationCtrl.initList" >
                    <a href="#" ng-click="applicationCtrl.chooseProject(project)">
                      {{project.projectAlphaId}} - {{project.projectID}}
                    </a>
                  </li>
                </ul>
              </div>
              <input type="text" class="form-control" placeholder="Project ID" ng-model="applicationCtrl.id" ng-required="true">
            </div>
            <!--locale input group -->
            <div class="input-group">
              <div class="input-group-btn">
                <!--dropdown button -->
                  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Язык <span class="caret"></span>
                  </button>
                    <!-- dropdown btn LIST -->
                  <ul class="dropdown-menu">
                    <li ng-repeat="locale in applicationCtrl.chosen.locales" ng-click="applicationCtrl.locale = locale">
                      <a href="#">
                        {{locale}}
                      </a>
                    </li>
                  </ul>
              </div>
              <input type="text" class="form-control" placeholder="Locale" ng-model="applicationCtrl.locale" ng-required="true">
            </div>
          </div>
          <button type="submit" class="btn btn-primary" ng-click="applicationCtrl.getTrans()">Открыть</button>
          <button type="submit" class="btn btn-warning" ng-click="applicationCtrl.makeNew()">Создать документ</button>
        </form>
        <!-- slight fix for proper view of "restore" button -->
        <form class="navbar-form pull-right">
          <button type="submit" class="btn btn-info" ng-click="applicationCtrl.checkCopies()">Восстановление</button>
        </form>
      </div>
    </nav>

    <!-- CONTENT -->
    <!-- BACKUP-MENU CONTAINER -->
    <div class="container col-md-10" ng-if="applicationCtrl.copiesList.length">
      <h3>Резервные копии:</h3>
      <div class="panel panel-default" ng-repeat="copy in applicationCtrl.copiesList">
        <div class="panel-heading">
          <h3 class="panel-title">{{copy.projectAlphaId}} - {{copy.projectID}}</h3>
        </div>
        <div class="panel-body">
          Restore - 
          <button type="button" class="btn btn-info" style="margin: 0 2px;" ng-repeat="locale in copy.locales"
           ng-click="applicationCtrl.restore(copy.projectID, locale)">{{locale}}</button>
        </div>
      </div>
    </div>

    <!-- MAIN CONTAINER -->

    <div class="col-md-5" ng-repeat="item in applicationCtrl.data track by $index">
      <form>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">
              ID: {{item.projectID}} - {{item.projectAlphaId}} <span class="label label-info" >{{item.locale}}</span>
              <button type="button" class="btn btn-danger btn-xs pull-right" ng-click="applicationCtrl.removeDoc(item)">УДАЛИТЬ</button>
            </h3>
          </div>
          <div class="panel-body">
             <button type="submit" class="btn btn-success btn-xs" ng-click="applicationCtrl.changeTranslation(item)">Сохранить</button>
             <button type="submit" class="btn btn-warning btn-xs" ng-click="applicationCtrl.makeCopy(item)"
              ng-if="applicationCtrl.data.length < 2">Взять за основу</button>
          </div>
        </div>

        <div ng-repeat="(key, value) in item.translations" class="container-fluid well">

          <h4>Группа:
           <span class="label label-default" >{{key}}</span> 
           <button type="button" class="btn btn-danger btn-xs pull-right" ng-click="applicationCtrl.deleteGroup(item.translations, key)"
            ng-if="applicationCtrl.data.length < 2">Удалить группу</button>
          </h4>

          <div class="input-group" ng-repeat="(def, trans) in value" style="margin:10px 0;">
            <span class="input-group-addon" id="basic-addon1">{{def}}</span>
            <input type="text" class="form-control" placeholder="" aria-describedby="basic-addon1"
             value="{{trans}}" ng-model="item.translations[key][def]">
            <span class="input-group-btn">
                <button class="btn btn-default" type="button" ng-click="" ng-if="trans.length > 45">
                  <span class="glyphicon glyphicon-modal-window"></span>
                </button>
                <button class="btn btn-default" type="button" ng-click="applicationCtrl.deleteField(item.translations, key, def)"
                 title="удалить поле" ng-if="applicationCtrl.data.length < 2">
                  <span class="glyphicon glyphicon-remove"></span>
                </button>
            </span>
          </div>

          <div class="input-group col-md-7" ng-if="applicationCtrl.data.length < 2">
            <input type="text" class="form-control" placeholder="Добавить новое поле в группу" aria-describedby="basic-addon1" ng-model="newField">
            <span class="input-group-btn">
              <button class="btn btn-default" type="button" ng-click="applicationCtrl.addField(item.translations, key, newField)"
                title="Добавить поле"><span class="glyphicon glyphicon-plus"></span></button>
            </span>
          </div>
        </div>

        <div class="input-group col-md-7" ng-if="applicationCtrl.data.length < 2">
            <input type="text" class="form-control" placeholder="Создать группу" aria-describedby="basic-addon1" ng-model="newGroup">
            <span class="input-group-btn">
              <button class="btn btn-default" type="button" ng-click="applicationCtrl.addGroup(item.translations, newGroup)"
                title="Создать группу"><span class="glyphicon glyphicon-plus"></span></button>
            </span>
        </div>
      </form>
    </div>
    
    <!-- GROWLS CONTAINER -->
    <div class="col-md-2" ng-controller="GrowlCtrl as growlCtrl" style="position:fixed; right:0;">
      <alert ng-repeat="growl in growlCtrl.growls" type="{{growl.type}}" close="growlCtrl.closeGrowl($index)">
        {{growl.msg}}
      </alert>
    </div>

  </body>
    <!-- SCRIPTS -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/angular.js"></script>
  <script type="text/javascript" src="js/angular-resource.js"></script>
  <script type="text/javascript" src="js/ui-bootstrap-custom-0.13.0.min.js"></script>
  <script type="text/javascript" src="js/ui-bootstrap-custom-tpls-0.13.0.js"></script>
  <script type="text/javascript" src="app.js"></script>
  
</html>